---
import Layout from '../layouts/Layout.astro';
import NavCard from '../components/NavCard/index.astro';
import GlobalSettings from '../components/GlobalSettings/index.tsx';
import HeaderAuth from '../components/HeaderAuth/index.tsx';
import links from '../content/links.json';

type LinkItem = {
  title: string;
  url: string;
  desc: string;
};

type Category = {
  category: string;
  links: LinkItem[];
};

const data = links as Category[];
---

<Layout title="Dashboard">
  <main class="container mx-auto px-4 pb-24 max-w-7xl">
    {/* Sticky Glass Header */}
    <header class="sticky top-6 z-50 mx-auto max-w-3xl rounded-full bg-background/80 backdrop-blur-xl border border-border/40 shadow-sm flex items-center justify-between px-5 py-2.5 mb-20 transition-all duration-300 hover:shadow-md hover:border-border/60">
      <div class="flex items-center gap-3 select-none">
        <div class="w-9 h-9 bg-primary text-primary-foreground rounded-lg flex items-center justify-center font-bold text-lg shadow-sm">M</div>
        <span class="font-semibold text-foreground tracking-tight">My Space</span>
      </div>
      <div class="flex items-center gap-2">
         <HeaderAuth client:load />
         <div class="w-px h-5 bg-border mx-2"></div>
         <GlobalSettings client:load />
      </div>
    </header>

    {/* Hero Section */}
    <div class="text-center mb-24 animate-in fade-in slide-in-from-bottom-8 duration-700">
      <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight text-foreground mb-6">
        Welcome Back
      </h1>
      <p class="text-xl text-muted-foreground mb-12 max-w-2xl mx-auto leading-relaxed">
        What would you like to build today?
      </p>
      
      <div class="relative max-w-lg mx-auto group">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground w-5 h-5 transition-colors group-focus-within:text-primary" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input 
          type="text" 
          id="search-input" 
          placeholder="Search tools... (Press '/')" 
          autocomplete="off" 
          class="h-12 w-full rounded-full border border-input bg-background px-12 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 shadow-sm transition-all hover:shadow-md hover:border-ring/30"
        />
        <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none hidden sm:flex h-6 select-none items-center gap-1 rounded border bg-muted px-2 font-mono text-[10px] font-medium text-muted-foreground opacity-100">
          <span class="text-xs">/</span>
        </div>
      </div>
    </div>

    {/* Content Grid */}
    <div id="content-wrapper" class="space-y-16">
      {data.map((cat, index) => (
        <section 
          class="category-section animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-backwards" 
          style={`animation-delay: ${index * 100}ms`} 
          data-category={cat.category.toLowerCase()}
        >
          <div class="flex items-center gap-6 mb-8">
            <h2 class="text-xs font-bold uppercase tracking-widest text-muted-foreground whitespace-nowrap">
              {cat.category}
            </h2>
            <div class="h-px flex-1 bg-border/50"></div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {cat.links.map((link) => (
              <div class="card-wrapper h-full" data-keywords={`${link.title} ${link.desc}`.toLowerCase()}>
                <NavCard {...link} />
              </div>
            ))}
          </div>
        </section>
      ))}
      
      <div id="no-results" class="hidden flex-col items-center justify-center py-32 text-center animate-in fade-in zoom-in-95 duration-300">
        <div class="w-16 h-16 bg-muted/50 rounded-full flex items-center justify-center mb-6 text-3xl opacity-50">
          üîç
        </div>
        <h3 class="text-xl font-semibold mb-2">No matches found</h3>
        <p class="text-muted-foreground mb-8 max-w-sm mx-auto">
          Try searching for something else or clear the filter.
        </p>
        <button id="clear-search" class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
          Clear Search
        </button>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Search Functionality
  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const categories = document.querySelectorAll('.category-section');
  const noResults = document.getElementById('no-results');
  const clearBtn = document.getElementById('clear-search');

  function performSearch() {
    const query = searchInput.value.toLowerCase().trim();
    let hasResults = false;

    categories.forEach((catSection) => {
      let hasVisibleCardsInCat = false;
      const cards = catSection.querySelectorAll('.card-wrapper');

      cards.forEach((card) => {
        const keywords = (card as HTMLElement).dataset.keywords || '';
        const isMatch = keywords.includes(query);
        if (isMatch) {
          (card as HTMLElement).style.display = 'block';
          hasVisibleCardsInCat = true;
          hasResults = true;
        } else {
          (card as HTMLElement).style.display = 'none';
        }
      });

      // Hide empty categories
      (catSection as HTMLElement).style.display = hasVisibleCardsInCat ? 'block' : 'none';
    });

    if (noResults) {
      if (hasResults) {
        noResults.classList.add('hidden');
        noResults.classList.remove('flex');
      } else {
        noResults.classList.remove('hidden');
        noResults.classList.add('flex');
      }
    }
  }

  searchInput?.addEventListener('input', performSearch);
  
  clearBtn?.addEventListener('click', () => {
    searchInput.value = '';
    performSearch();
    searchInput.focus();
  });

  // Keyboard shortcut '/'
  document.addEventListener('keydown', (e) => {
    if (e.key === '/' && document.activeElement !== searchInput) {
      e.preventDefault();
      searchInput?.focus();
    }
    if (e.key === 'Escape' && document.activeElement === searchInput) {
      searchInput.blur();
    }
  });
</script>